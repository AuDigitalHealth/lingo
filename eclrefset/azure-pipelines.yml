trigger:
- ecl-refset-process

schedules:
- cron: "0 20 * * *"  # Runs every day at 7am AEDT
  displayName: Daily ECL Refset Process Pipeline Run
  branches:
    include:
      - ecl-refset-process
  always: true

pool:
  vmImage: ubuntu-latest

variables:
  mavenCache: $(Pipeline.Workspace)/.m2/repository
  mavenOptions: '-Dmaven.repo.local=$(mavenCache) -Dmaven.settings.security=never'

steps:

- task: Maven@3
  displayName: 'Maven clean package'
  inputs:
    mavenPomFile: 'eclrefset/pom.xml'
    options: '-DargLine="-Dims-username=$(imsUsername) -Dims-password=$(imsPassword)"'
    mavenOptions: '$(mavenOptions) -Xmx3072m -Dims-username=$(imsUsername) -Dims-password=$(imsPassword)'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'clean package'

- script: |
    export JAVA_HOME=/usr/lib/jvm/temurin-17-jdk-amd64
    export PATH=$JAVA_HOME/bin:$PATH
    cd $(System.DefaultWorkingDirectory)/eclrefset/target
    java -jar -Dspring.profiles.active=prod -Dims-username=$(imsUsername) -Dims-password=$(imsPassword) eclrefset-0.0.1-SNAPSHOT.jar
  displayName: 'Run JAR file'
