trigger:
- ecl-refset-process

pool:
  vmImage: ubuntu-latest

variables:
  mavenCache: $(Pipeline.Workspace)/.m2/repository
  mavenOptions: '-Dmaven.repo.local=$(mavenCache) -Dmaven.settings.security=never'

steps:

- task: Maven@3
  displayName: 'Maven clean package'
  inputs:
    mavenPomFile: 'eclrefset/pom.xml'
    options: '-DargLine="-Dims-username=$(imsUsername) -Dims-password=$(imsPassword)"'
    mavenOptions: '$(mavenOptions) -Xmx3072m -Dims-username=$(imsUsername) -Dims-password=$(imsPassword)'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    jdkArchitectureOption: 'x64'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'clean package'

- run: |
    export JAVA_HOME=/usr/lib/jvm/temurin-17-jdk-amd64
    export PATH=$JAVA_HOME/bin:$PATH
    cd $(System.DefaultWorkingDirectory)/eclrefset/target
    java -jar eclrefset-0.0.1-SNAPSHOT.jar -Dspring.profiles.active=prod -Dims-username=$(IMS_USERNAME) -Dims-password=$(IMS_PASSWORD)
  env: 
    IMS_USERNAME: ${{variables.imsUsername}}
    IMS_PASSWORD: ${{variables.imsPassword}}
  displayName: 'Run JAR file'
